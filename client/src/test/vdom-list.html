<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>List Test</title>
</head>
<body>
<script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/prop-types@15.6/prop-types.js"><!-- for sortable --></script>
<script crossorigin src="/react-sortable-hoc.umd.js"></script>
<script type="module">

import {ListRoot} from "../test/vdom-list.js"
import {createSyncProviders} from "../main/vdom-core.js"

const {createElement:$,useState} = React

function Text({value}){
    return value
}


const node = obj => Object.fromEntries(Object.entries(obj).flatMap(([k,v])=> !Array.isArray(v) ? [[k,v]] : [[k,v.map(c=>c.key)],...v.map(c=>[c.key,c])] ))


function App(){
    const [setupMode,setSetupMode] = useState("")
    const exCol = (rowKey,colKey,colPriority) => node({
        key: colKey, colPriority,
        content: [{ tp: Text, identity: 1, value: rowKey+colKey, key: "text"}]
    })
    const exRow = rowKey => node({
        key: rowKey,
        cells: [
            exCol(rowKey,":c0",2),
            exCol(rowKey,":c1",2),
            exCol(rowKey,":c2",1),
            exCol(rowKey,":c3",1),
            exCol(rowKey,":c4",0),
            exCol(rowKey,":c5",0),
            exCol(rowKey,":c6",1),
            exCol(rowKey,":c7",1),
            exCol(rowKey,":c8",2),
            exCol(rowKey,":c9",2),
        ]
    })
    const listEl = $(ListRoot,node({
        key: "list",
        setupMode,
        enableColDrag: true,
        head: [
            exRow(":hr0"),
            exRow(":hr1"),
        ],
        body: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19].map(k=>exRow(":r"+k)),
    }))
    const children = [
        $("button",{key:"rowDrag",onClick:ev=>setSetupMode("rowDrag")},"rowDrag"),
        $("button",{key:"colDrag",onClick:ev=>setSetupMode("colDrag")},"colDrag"),
        listEl
    ]

    const sender = { enqueue: ()=>{} }
    const ack = null
    return createSyncProviders({ sender, ack, children })
}

const containerElement = document.createElement("div")
document.body.appendChild(containerElement)
ReactDOM.render($(App),containerElement)
</script>
<!--
features:
    row drag
    col drag
    col hide
    col expand


todo: resolve tag by key (exists), so remove ':'
-->
</body>
</html>